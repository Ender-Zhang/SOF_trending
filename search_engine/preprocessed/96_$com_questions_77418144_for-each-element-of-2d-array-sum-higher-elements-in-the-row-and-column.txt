input datafram numpi array shape element check mani valu higher given row column exampl total higher valu element code work good shape matrix take hour wonder way effici way also tri numpi splite shape merg array end runtim close eachoth could get progress came follow want similar rank element basic tell mani item smaller given element mayb subtract rank rankdata rank convert smaller bigger invert rank rel number item count subtract rank number without tie third row exampl work expect slight complic tie rank trial error found use gave desir behavior frank still wrap head work take answer grain salt still give desir output input data handl size data far less hour take second understand rank similar sort oper answer reli implement rather appli tend much slower anoth possibl solut initi array use numpi broadcast previou solut take long time run thu speed calcul use numba numba prang parallel loop code took minut second run output